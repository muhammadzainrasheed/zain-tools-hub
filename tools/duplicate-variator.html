<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duplicate Variator â€” Zain Tools Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        /* â”€â”€ Page wrapper â”€â”€ */
        .variator-page {
            padding: 2rem;
            max-width: 1100px;
            margin: 0 auto;
        }

        .variator-wrap > h2 {
            display: flex;
            align-items: center;
            gap: .7rem;
            font-size: 1.9rem;
            font-weight: 900;
            color: #fff;
            margin-bottom: .4rem;
        }
        .variator-sub {
            color: rgba(255,255,255,.5);
            font-size: .95rem;
            margin-bottom: 1.8rem;
            max-width: 780px;
        }

        /* â”€â”€ Settings bar â”€â”€ */
        .settings-bar {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
            background: rgba(255,255,255,.06);
            border: 1px solid rgba(255,255,255,.12);
            border-radius: 14px;
            padding: 1rem 1.4rem;
            margin-bottom: 1.6rem;
            font-size: .9rem;
            color: rgba(255,255,255,.7);
        }
        .setting-group {
            display: flex;
            align-items: center;
            gap: .5rem;
            white-space: nowrap;
        }
        .setting-group label { font-weight: 600; }
        .slider-value {
            font-weight: 800;
            color: #a78bfa;
            font-size: 1.05rem;
            min-width: 18px;
            text-align: center;
        }
        input[type="range"] {
            width: 100px;
            accent-color: #7c3aed;
        }
        .char-count-value {
            font-weight: 700;
            color: #fff;
        }

        /* â”€â”€ Grid: input + analysis â”€â”€ */
        .variator-grid {
            display: grid;
            grid-template-columns: 1fr 340px;
            gap: 1.4rem;
            margin-bottom: 1.4rem;
        }
        @media(max-width:800px){ .variator-grid{ grid-template-columns:1fr; } }

        .section-label {
            display: block;
            font-size: .78rem;
            font-weight: 700;
            letter-spacing: .08em;
            text-transform: uppercase;
            color: rgba(255,255,255,.45);
            margin-bottom: .5rem;
        }

        .variator-textarea {
            width: 100%;
            padding: 1rem 1.1rem;
            background: rgba(255,255,255,.05);
            border: 1px solid rgba(255,255,255,.15);
            border-radius: 12px;
            color: #fff;
            font-family: 'Inter', sans-serif;
            font-size: .93rem;
            line-height: 1.6;
            resize: vertical;
            outline: none;
            transition: border-color .2s;
            box-sizing: border-box;
        }
        .variator-textarea:focus { border-color: #a78bfa; }
        .variator-textarea[readonly] { background: rgba(255,255,255,.03); cursor: default; }

        .char-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: .35rem;
            font-size: .8rem;
            color: rgba(255,255,255,.4);
        }
        .char-row.over { color: #f87171 !important; font-weight: 700; }

        /* â”€â”€ Duplicate analysis box â”€â”€ */
        .dup-box {
            background: rgba(255,255,255,.04);
            border: 1px solid rgba(255,255,255,.1);
            border-radius: 12px;
            padding: 1rem 1.1rem;
            min-height: 180px;
            font-size: .88rem;
        }
        .no-dup {
            color: #34d399;
            font-weight: 600;
            margin: 0;
        }
        .dup-box ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: .5rem;
        }
        .dup-box li {
            display: flex;
            align-items: center;
            gap: .5rem;
            color: rgba(255,255,255,.75);
            font-size: .86rem;
        }
        .dup-tag {
            display: inline-block;
            padding: .2rem .7rem;
            border-radius: 6px;
            font-weight: 700;
            font-size: .82rem;
            letter-spacing: .02em;
        }
        .dup-count {
            color: rgba(255,255,255,.5);
            font-size: .82rem;
        }

        /* â”€â”€ Output section â”€â”€ */
        .output-section { margin-bottom: 1.2rem; }

        .output-label-row {
            display: flex;
            align-items: center;
            gap: .7rem;
            margin-bottom: .5rem;
        }
        .output-badge {
            font-size: .72rem;
            font-weight: 700;
            padding: .2rem .65rem;
            border-radius: 5px;
            letter-spacing: .05em;
        }
        .badge-full { background: rgba(124,58,237,.25); color: #c4b5fd; border: 1px solid rgba(124,58,237,.4); }
        .badge-trunc { background: rgba(245,158,11,.2); color: #fbbf24; border: 1px solid rgba(245,158,11,.4); }

        .trunc-note {
            font-size: .82rem;
            color: rgba(255,255,255,.4);
            margin-bottom: .5rem;
            line-height: 1.5;
        }

        /* â”€â”€ Actions row â”€â”€ */
        .variator-actions {
            display: flex;
            gap: .8rem;
            flex-wrap: wrap;
            margin-top: 1.4rem;
        }
        .action-group {
            display: flex;
            gap: .6rem;
            align-items: center;
        }

        /* â”€â”€ Mode toggle â”€â”€ */
        .mode-toggle {
            display: flex;
            gap: .5rem;
            margin-bottom: 1.6rem;
        }
        .mode-btn {
            padding: .55rem 1.3rem;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,.15);
            background: transparent;
            color: rgba(255,255,255,.55);
            font-family: 'Inter', sans-serif;
            font-size: .88rem;
            font-weight: 600;
            cursor: pointer;
            transition: all .2s;
        }
        .mode-btn:hover { background: rgba(255,255,255,.06); color: #fff; }
        .mode-btn.active {
            background: #7c3aed;
            color: #fff;
            border-color: #7c3aed;
            box-shadow: 0 2px 10px rgba(124,58,237,.35);
        }

        /* â”€â”€ Language badge â”€â”€ */
        .lang-badge {
            display: inline-flex;
            align-items: center;
            gap: .3rem;
            font-size: .78rem;
            font-weight: 600;
            padding: .15rem .6rem;
            border-radius: 99px;
            background: rgba(255,255,255,.07);
            border: 1px solid rgba(255,255,255,.12);
            color: rgba(255,255,255,.5);
        }
    </style>
</head>
<body>

<!-- ===== NAVIGATION ===== -->
<nav class="nav">
    <a href="../index.html" class="nav-brand">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"
             stroke-linecap="round" stroke-linejoin="round" style="width:20px;height:20px;">
            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
        </svg>
        Zain Tools
    </a>
    <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')">
        <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
    </button>
    <div class="nav-links">
        <a href="../index.html"           class="nav-btn">Home</a>
        <a href="word-changer.html"       class="nav-btn">Word Changer</a>
        <a href="asin-cleaner.html"       class="nav-btn">ASIN Cleaner</a>
        <a href="asin-splitter.html"      class="nav-btn">ASIN 900</a>
        <a href="voucher-tool.html"       class="nav-btn">Vouchers</a>
        <a href="duplicate-variator.html" class="nav-btn">Variator</a>
        <a href="search-optimizer.html"   class="nav-btn">Search Terms</a>
    </div>
</nav>

<!-- ===== PAGE ===== -->
<div class="variator-page">
<div class="variator-wrap">

    <h2>
        <svg width="26" height="26" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M4 7V4h16v3"/><path d="M9 20h6"/><path d="M12 4v16"/>
        </svg>
        Auto Duplicate Word Variator
    </h2>
    <p class="variator-sub">
        Paste a full Amazon product title. Words repeated at or above the threshold are replaced
        with safe Unicode variants. Stop-words (de, fÃ¼r, les, vanâ€¦) are never touched.
        Output is always delivered in proper Title&nbsp;Case.
    </p>

    <!-- Supported languages note -->
    <div style="display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1.6rem;">
        <span class="lang-badge">ğŸ‡¬ğŸ‡§ EN</span>
        <span class="lang-badge">ğŸ‡©ğŸ‡ª DE</span>
        <span class="lang-badge">ğŸ‡«ğŸ‡· FR</span>
        <span class="lang-badge">ğŸ‡ªğŸ‡¸ ES</span>
        <span class="lang-badge">ğŸ‡®ğŸ‡¹ IT</span>
        <span class="lang-badge">ğŸ‡³ğŸ‡± NL</span>
        <span class="lang-badge">ğŸ‡¸ğŸ‡ª SE</span>
    </div>

    <!-- Settings bar -->
    <div class="settings-bar">
        <div class="setting-group">
            <label for="dupThreshold">Replace from</label>
            <span id="thresholdValue" class="slider-value">3</span>
            <span id="occLabel">rd occurrence onwards</span>
            <input type="range" id="dupThreshold" min="2" max="4" value="3">
        </div>
        <div class="setting-group" style="margin-left:auto;">
            <span>Chars:</span>
            <span id="inputCharCount" class="char-count-value">0</span>
        </div>
        <div class="setting-group">
            <span>Words:</span>
            <span id="inputWordCount" class="char-count-value">0</span>
        </div>
    </div>

    <!-- Input + Analysis grid -->
    <div class="variator-grid">
        <div>
            <label class="section-label">Input Title</label>
            <textarea id="varInput" class="variator-textarea"
                placeholder="Paste your Amazon product title here (any language)..."
                style="min-height:180px;"></textarea>
            <div class="char-row">
                <span id="inputCharLabel">0 / 200 characters</span>
                <span id="inputOverWarn" style="display:none;color:#f87171;font-weight:700;">
                    âš  Over 200 chars
                </span>
            </div>
        </div>
        <div>
            <label class="section-label">Duplicate Analysis</label>
            <div id="dupInfo" class="dup-box">
                <p class="no-dup" style="color:rgba(255,255,255,.3);">
                    Paste a title to see analysis.
                </p>
            </div>
        </div>
    </div>

    <!-- OUTPUT 1: Full variation -->
    <div class="output-section">
        <div class="output-label-row">
            <label class="section-label" style="margin:0;">Output Title</label>
            <span class="output-badge badge-full">FULL VARIATION</span>
        </div>
        <textarea id="varOutput" class="variator-textarea"
            style="min-height:110px;" readonly
            placeholder="Output appears here automatically..."></textarea>
        <div class="char-row">
            <span id="outputCharLabel">0 / 200 characters</span>
        </div>
    </div>

    <!-- Action buttons -->
    <div class="variator-actions">
        <div class="action-group">
            <button class="btn-primary" id="varCopyBtn">
                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                </svg>
                Copy Output
            </button>
        </div>
        <button class="btn-secondary" id="varClearBtn">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
            </svg>
            Clear
        </button>
    </div>

</div><!-- /variator-wrap -->
</div><!-- /variator-page -->

<script src="../js/main.js"></script>
<script>
/* ================================================================
   AUTO DUPLICATE WORD VARIATOR â€” v2
   Fixes: Stop-words | Title Case | Smart Truncation | Dual Output
   ================================================================ */

// â”€â”€ SAFE UNICODE MAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Only characters confirmed to render correctly on Amazon EU
// (UK, DE, NL, IT, ES, SE) without becoming "?" marks.
const SAFE_MAP = {
    'a': ['Ã ','Ã¢','Ä'],
    'c': ['Ã§','Ä‡'],
    'e': ['Ã¨','Ãª','Ã«','Ä“'],
    'i': ['Ã¬','Ã®','Ã¯','Ä«'],
    'l': ['Äº','Ä¼'],
    'n': ['Ã±','Å„'],
    'o': ['Ã²','Ã´','Ã¶','Å','Ã¸'],
    'r': ['Å•'],
    's': ['Å›','Å¡','ÅŸ'],
    't': ['Å£','Å¥'],
    'u': ['Ã¹','Ã»','Ã¼','Å«'],
    'y': ['Ã¿','Ã½'],
    'z': ['Åº','Å¾','Å¼'],
};

// â”€â”€ STOP-WORDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// These words are NEVER varied, no matter how often they repeat.
// Keys are plain ASCII lowercase (after stripping accents).
const STOP_WORDS = new Set([
    // English
    'a','an','the','and','or','but','for','nor','so','yet',
    'in','on','at','to','of','by','up','as','is','it',
    'be','do','go','if','my','no','us','we','its',
    // French
    'de','du','des','le','la','les','un','une','au','aux',
    'et','ou','en','par','sur','sous','avec','pour','dans',
    'que','qui','ne','ce','se','sa','son','ses',
    // German
    'der','die','das','dem','den','ein','eine','und','oder',
    'fur','von','mit','auf','bei','nach','aus','zu','im','am',
    'ist','als','an','es','er','sie','wir','ich','wie','zum',
    'zur','des','vom','ins','ans','ums',
    // Spanish
    'el','los','las','una','unos','unas','del','al',
    'y','o','en','con','por','para','que','se','su','lo',
    'sus','nos','les','si','ya','ni','mas',
    // Italian
    'il','lo','gli','un','del','della','dei','degli','delle',
    'di','da','con','tra','fra','e','ed','ma','che','si',
    'ci','ne','non','col','al','ai','agli','alle','alle',
    // Dutch
    'het','een','van','voor','met','op','te','of',
    'aan','bij','tot','uit','over','door','als','om','ze',
    'zij','hij','wij','hun','hen','via',
    // Swedish
    'den','det','ett','av','med','pa','till','och',
    'eller','att','ar','som','har','om','vi','ni',
    'han','hon','dem','nar','men','sin','sig',
]);

// â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

/** Strip all diacritics â†’ plain lowercase ASCII */
function toPlainASCII(str) {
    return str
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .toLowerCase()
        .replace(/[^a-z0-9]/g, '');
}

/** Normalize a token for frequency counting */
function normalizeWord(w) {
    return w.normalize('NFC')
        .toLowerCase()
        .replace(/[^\p{L}\p{N}]+/gu, '');
}

/** Split text into tokens preserving whitespace and punctuation */
function tokenize(text) {
    return text.match(/\S+|\s+/g) || [text];
}

/** Build frequency map over tokens */
function countWords(tokens) {
    const counts = {};
    const originals = {};
    for (const tok of tokens) {
        if (!/\p{L}/u.test(tok)) continue;
        const key = normalizeWord(tok);
        if (!key) continue;
        counts[key] = (counts[key] || 0) + 1;
        if (!originals[key]) originals[key] = tok;
    }
    return { counts, originals };
}

/** Apply a single Unicode replacement to a token */
function applyVariation(token) {
    const lower = token.toLowerCase();
    const chars = [...lower];
    const candidates = [];

    for (let i = 0; i < chars.length; i++) {
        if (SAFE_MAP[chars[i]]) candidates.push(i);
    }
    if (candidates.length === 0) return token; // no replaceable char â†’ unchanged

    const idx = candidates[Math.floor(Math.random() * candidates.length)];
    const opts = SAFE_MAP[chars[idx]];
    const repl = opts[Math.floor(Math.random() * opts.length)];

    // Preserve case of replaced character
    const origChar = token[idx];
    const isUpper = origChar === origChar.toUpperCase() && origChar !== origChar.toLowerCase();
    chars[idx] = isUpper ? repl.toUpperCase() : repl;

    // Rebuild â€” keep original characters at non-replaced positions
    let result = '';
    for (let i = 0; i < chars.length; i++) {
        result += (i === idx) ? chars[i] : (token[i] ?? chars[i]);
    }
    return result;
}

/** Walk tokens, replace Nth+ occurrences (skipping stop-words) */
function transformTokens(tokens, counts, threshold) {
    const seen = {};
    const out = [];
    for (const raw of tokens) {
        if (!/\p{L}/u.test(raw)) { out.push(raw); continue; }

        const key  = normalizeWord(raw);
        if (!key) { out.push(raw); continue; }

        const plain = toPlainASCII(key);

        // Never touch stop-words
        if (STOP_WORDS.has(plain)) { out.push(raw); continue; }

        seen[key] = (seen[key] || 0) + 1;

        // Only vary if this word repeats enough AND we've now hit the threshold
        if (counts[key] >= threshold && seen[key] >= threshold) {
            out.push(applyVariation(raw));
        } else {
            out.push(raw);
        }
    }
    return out;
}

// â”€â”€ TITLE CASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/**
 * Proper Title Case for Amazon titles in 7 languages.
 *
 * What stays LOWERCASE (minor words â€” articles, prepositions, conjunctions):
 *   English:  a, an, the, and, but, or, for, nor, so, yet, at, by, in, of, on, to, up, as
 *   Spanish:  de, del, al, el, la, los, las, un, una, y, o, en, con, por, para, que, se, su
 *   Italian:  di, da, in, il, lo, la, i, gli, le, un, una, del, della, dei, e, o, ma, che, si
 *   French:   de, du, des, le, la, les, un, une, au, aux, et, ou, en, par, sur, pour, dans, que
 *   German:   der, die, das, dem, den, ein, eine, und, oder, in, an, am, im, zu, zur, zum, von, mit
 *   Dutch:    de, het, een, van, voor, met, op, te, en, of, aan, bij, tot, uit, door, als, om
 *   Swedish:  den, det, en, ett, av, fÃ¶r, med, pÃ¥, till, och, eller, att, Ã¤r, om, i
 *
 * What gets CAPITALIZED: ALL other words (product keywords, nouns, adjectives, etc.)
 *
 * Exceptions:
 *   - First word of entire title â†’ ALWAYS capitalize
 *   - First word after | - â€“ : , â†’ ALWAYS capitalize
 *   - Hyphenated words â†’ each part capitalized: Clip-On, Heat-Resistant
 *   - Known acronyms (ABS, USB, LEDâ€¦) â†’ stay ALL CAPS
 */
const TITLE_MINOR = new Set([
    // â”€â”€ English â”€â”€
    'a','an','the',
    'and','but','or','for','nor','so','yet',
    'at','by','in','of','on','to','up','as','via',
    // â”€â”€ Spanish â”€â”€
    'de','del','al','el','la','los','las','un','una','unos','unas',
    'y','o','en','con','por','para','que','se','su','sus','lo',
    'ni','sin','ante','bajo','tras','entre','hacia','desde','sobre',
    // â”€â”€ Italian â”€â”€
    'di','da','il','lo','gli','le','un','una','del','della','dei',
    'degli','delle','e','ed','o','ma','che','si','ci','col','al',
    'ai','agli','alle','fra','tra','con','su','per',
    // â”€â”€ French â”€â”€
    'du','des','au','aux','et','ou','ne','ni','car','par','sur',
    'dans','avec','sous','vers','chez','dÃ¨s','dÃ¨s',
    // â”€â”€ German â”€â”€
    'der','die','das','dem','den','ein','eine','eines','einer',
    'und','oder','aber','doch','im','am','zum','zur','vom',
    'beim','ins','ans','ums','ans','wie','als',
    // â”€â”€ Dutch â”€â”€
    'het','een','van','voor','met','op','te','aan','bij','tot',
    'uit','door','als','om','ze','bij','via','per',
    // â”€â”€ Swedish â”€â”€
    'den','det','ett','av','fÃ¶r','med','pÃ¥','till','och','eller',
    'att','Ã¤r','om','hos','vid','hos','kring',
]);

const ALLCAPS_WORDS = new Set([
    'abs','ean','usb','led','diy','uv','hd','4k','2k','xl','xxl',
    'lp','cd','dvd','pc','dna','iq','uk','eu','us',
]);

function toTitleCase(str) {
    // Tokenize: separators | whitespace | words
    const tokens = str.match(/[|\-â€“â€”:,]|[\s]+|[^\s|\-â€“â€”:,]+/g) || [];
    let capNext = true; // first token always capitalized

    return tokens.map(tok => {
        // Whitespace â†’ unchanged
        if (/^\s+$/.test(tok)) return tok;

        // Separator â†’ pass through, flag next word to capitalize
        if (/^[|\-â€“â€”:,]$/.test(tok)) {
            capNext = true;
            return tok;
        }

        const lower = tok.toLowerCase();
        const plain = toPlainASCII(lower);

        // Known acronyms â†’ ALL CAPS
        if (ALLCAPS_WORDS.has(plain)) {
            capNext = false;
            return tok.toUpperCase();
        }

        // Minor word in the MIDDLE of title â†’ lowercase
        if (!capNext && TITLE_MINOR.has(plain)) {
            capNext = false;
            return lower;
        }

        // Hyphenated: each part capitalized â†’ Clip-On, Heat-Resistant
        if (tok.includes('-')) {
            const result = tok.split('-').map(part => {
                if (!part) return part;
                const p = part.toLowerCase();
                return p.charAt(0).toUpperCase() + p.slice(1);
            }).join('-');
            capNext = false;
            return result;
        }

        // Normal word â†’ capitalize first letter
        capNext = false;
        return lower.charAt(0).toUpperCase() + lower.slice(1);

    }).join('');
}

// â”€â”€ DOM REFS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const varInput     = document.getElementById('varInput');
const varOutput    = document.getElementById('varOutput');
const dupInfo      = document.getElementById('dupInfo');
const thresholdEl  = document.getElementById('dupThreshold');
const thresholdVal = document.getElementById('thresholdValue');
const occLabel     = document.getElementById('occLabel');

const SUFFIX = { '2': 'nd', '3': 'rd', '4': 'th' };
const TAG_COLORS = [
    '#7c3aed','#2563eb','#059669','#dc2626','#d97706',
    '#0891b2','#db2777','#4f46e5','#16a34a','#b45309'
];

// â”€â”€ THRESHOLD SLIDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateThresholdLabel() {
    const v = thresholdEl.value;
    thresholdVal.textContent = v;
    occLabel.textContent = (SUFFIX[v] || 'th') + ' occurrence onwards';
}
updateThresholdLabel();
thresholdEl.addEventListener('input', () => { updateThresholdLabel(); processVariator(); });

// â”€â”€ CHAR / WORD COUNTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateCounts() {
    const inp = varInput.value;
    const out = varOutput.value;
    const inLen = inp.length;
    const outLen = out.length;
    const words = inp.trim() ? inp.trim().split(/\s+/).length : 0;

    document.getElementById('inputCharCount').textContent = inLen;
    document.getElementById('inputWordCount').textContent = words;

    const inLabel = document.getElementById('inputCharLabel');
    inLabel.textContent = `${inLen} / 200 characters`;
    inLabel.className = 'char-row' + (inLen > 200 ? ' over' : '');
    document.getElementById('inputOverWarn').style.display = inLen > 200 ? 'inline' : 'none';

    const outLabel = document.getElementById('outputCharLabel');
    outLabel.textContent = `${outLen} / 200 characters`;
    outLabel.className = 'char-row' + (outLen > 200 ? ' over' : '');
}

// â”€â”€ DUPLICATE ANALYSIS PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderDupInfo(counts, originals, threshold) {
    const dups = Object.entries(counts)
        .filter(([k, c]) => c >= threshold && !STOP_WORDS.has(toPlainASCII(k)))
        .sort((a, b) => b[1] - a[1]);

    if (dups.length === 0) {
        dupInfo.innerHTML = '<p class="no-dup">âœ“ No duplicates above threshold found.</p>';
        return;
    }

    let html = '<ul>';
    dups.forEach(([key, count], i) => {
        const color = TAG_COLORS[i % TAG_COLORS.length];
        html += `<li>
            <span class="dup-tag" style="background:${color}22;color:${color};border:1px solid ${color}44;">
                ${originals[key]}
            </span>
            <span class="dup-count">Ã— ${count}</span>
        </li>`;
    });
    html += '</ul>';
    dupInfo.innerHTML = html;
}

// â”€â”€ MAIN PROCESS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function processVariator() {
    const text = varInput.value;

    if (!text.trim()) {
        varOutput.value = '';
        dupInfo.innerHTML = '<p style="color:rgba(255,255,255,.3);margin:0;">Paste a title to see analysis.</p>';
        updateCounts();
        return;
    }

    const threshold = Number(thresholdEl.value);
    const tokens = tokenize(text);
    const { counts, originals } = countWords(tokens);

    renderDupInfo(counts, originals, threshold);

    // Apply Unicode variation then Title Case
    const transformed = transformTokens(tokens, counts, threshold);
    varOutput.value = toTitleCase(transformed.join(''));

    updateCounts();
}

// â”€â”€ EVENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let typingDelay;
varInput.addEventListener('input', () => {
    clearTimeout(typingDelay);
    typingDelay = setTimeout(processVariator, 80);
});

// Copy Output
document.getElementById('varCopyBtn').addEventListener('click', () => {
    const out = varOutput.value;
    if (!out.trim()) { showToast('Nothing to copy', true); return; }
    navigator.clipboard.writeText(out)
        .then(() => showToast('âœ“ Output copied!'))
        .catch(() => {
            const t = document.createElement('textarea');
            t.value = out; document.body.appendChild(t);
            t.select(); document.execCommand('copy');
            document.body.removeChild(t);
            showToast('âœ“ Output copied!');
        });
});

// Clear
document.getElementById('varClearBtn').addEventListener('click', () => {
    varInput.value = '';
    varOutput.value = '';
    dupInfo.innerHTML = '<p style="color:rgba(255,255,255,.3);margin:0;">Paste a title to see analysis.</p>';
    updateCounts();
    showToast('Cleared!');
});

// Init
updateCounts();
</script>
</body>
</html>
